<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
<!--  {# <meta name="csrf-token" content="{{ csrf_token() }}" /> #}  -->
  <title>{{ article.title }} - ç¤ºä¾‹åšå®¢</title>
  <meta name="description" content="Flask + Jinja2 + Vue 3 ç»„åˆå¼ï¼Œæ— éœ€æ‰“åŒ…çš„è¯„è®ºä¸ç‚¹èµç¤ºä¾‹" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/article.css') }}" />
  <script src="https://cdn.jsdelivr.net/npm/vue@3.4.38/dist/vue.global.prod.js" crossorigin="anonymous"></script>
</head>
<body>
  <header>
    <div class="container">
      <h1 class="article-title">{{ article.title }}</h1>
      <div class="meta">ç¤ºä¾‹åšå®¢ Â· ç”± Flask æ¸²æŸ“</div>
    </div>
  </header>

  <main class="container">
    <article class="content">
      <p>{{ article.content }}</p>
    </article>

    <section id="interactive-root" aria-labelledby="comments-heading">
      <div class="like-row">
        <button class="btn" type="button" v-on:click="onLike" v-bind:disabled="likeSubmitting" aria-live="polite">
          ğŸ‘ ç‚¹èµ
          <span v-if="likeSubmitting" class="muted">å¤„ç†ä¸­â€¦</span>
        </button>
        {% raw %}
        <span>ç‚¹èµæ•°ï¼š{{ likes }}</span>
        {% endraw %}
      </div>

      <h2 id="comments-heading">è¯„è®º</h2>

      <div class="comments">
        <template v-if="comments.length === 0">
          <p class="muted">æš‚æ— è¯„è®ºï¼Œå¿«æ¥æŠ¢æ²™å‘ï½</p>
        </template>
        {% raw %}
        <div v-for="c in comments" :key="c.id" class="comment-item">
          <div>
            <span class="comment-author">{{ c.author }}</span>
            <span class="comment-time">{{ c.created_at }}</span>
          </div>
          <div v-text="c.content"></div>
        </div>
        {% endraw %}
      </div>

      <form class="form" @submit.prevent="onSubmit">
        <div>
          <label for="author" class="sr-only">æ˜µç§°</label>
          <input id="author" class="input" type="text" placeholder="æ˜µç§°ï¼ˆå¿…å¡«ï¼‰" v-model.trim="form.author" maxlength="32" required />
        </div>
        <div>
          <label for="content" class="sr-only">è¯„è®ºå†…å®¹</label>
          <textarea id="content" class="textarea" placeholder="å‹å–„å‘è¨€ï¼Œæœ€å¤š 1000 å­—ï¼ˆå¿…å¡«ï¼‰" rows="4" v-model.trim="form.content" maxlength="1000" required></textarea>
        </div>

        {% raw %}
        <div class="muted" v-if="submitError">{{ submitError }}</div>
        {% endraw %}

        <div style="display:flex; gap:8px;">
          {% raw %}
          <button class="btn" type="submit" :disabled="submitting">
            {{ submitting ? "æäº¤ä¸­â€¦" : "å‘è¡¨è¯„è®º" }}
          </button>
          <button class="btn" type="button" v-on:click="refreshComments" v-bind:disabled="loadingComments">
            {{ loadingComments ? "åˆ·æ–°ä¸­â€¦" : "åˆ·æ–°è¯„è®º" }}
          </button>
          {% endraw %}
        </div>
      </form>
    </section>
  </main>

  <!-- æ³¨å…¥åç«¯æ•°æ®ï¼ˆä¾›å¤–éƒ¨ JS è¯»å–ï¼‰ -->
  <script>
    window.__ARTICLE_DATA__ = {
      id: {{ article.id | int }},
      likes: {{ article.likes | int }},
      comments: {{ article.comments | tojson }}
    };
  </script>

  <script src="https://cdn.jsdelivr.net/npm/axios@1.7.7/dist/axios.min.js" integrity="" crossorigin="anonymous"></script>
  <script src="{{ url_for('static', filename='js/article.js') }}"></script>
</body>
</html>